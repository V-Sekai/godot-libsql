Import("env")
import os

import inspect
src_file_path = inspect.getfile(lambda: None)
src_folder_path = os.path.dirname(src_file_path)

import subprocess
old_cwd = os.getcwd()

env.Append(CPPDEFINES=[("SQLITE_ENABLE_RBU", 1)])
env.Append(CPPDEFINES=[("SQLITE_USE_URI", 1)])
env.Append(CPPDEFINES=["SQLITE_ENABLE_JSON1"])
env.Append(CPPDEFINES=["SQLITE_OMIT_DEPRECATED"])

thirdparty_misc_dir = "thirdparty/libsql/"
thirdparty_misc_sources = [
    "sqlite3.c",
]
thirdparty_misc_sources = [thirdparty_misc_dir + file for file in thirdparty_misc_sources]

from pathlib import Path

env.Append(CPPPATH=["thirdparty/libsql"])
env.Append(CPPPATH=["thirdparty"])
env.Append(CPPPATH=["#modules/mvsqlite"])

os.chdir(old_cwd)

module_obj = []

env.add_source_files(module_obj, "*.cpp")

env_thirdparty = env.Clone()
env_thirdparty.disable_warnings()
env_thirdparty.add_source_files(module_obj, thirdparty_misc_sources)

env.modules_sources += module_obj
